<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ru"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Bank.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">chapter_003</a> &gt; <a href="index.source.html" class="el_package">ru.job4j.banking</a> &gt; <span class="el_source">Bank.java</span></div><h1>Bank.java</h1><pre class="source lang-java linenums">package ru.job4j.banking;

import java.util.*;

<span class="fc" id="L5">public class Bank {</span>
<span class="fc" id="L6">    private TreeMap&lt;User, List&lt;Account&gt;&gt; bankUsers = new TreeMap&lt;&gt;();</span>

    public TreeMap&lt;User, List&lt;Account&gt;&gt; getBankUsers() {
<span class="fc" id="L9">        return bankUsers;</span>
    }

    public void setBankUsers(TreeMap&lt;User, List&lt;Account&gt;&gt; bankUsers) {
<span class="fc" id="L13">        this.bankUsers = bankUsers;</span>
<span class="fc" id="L14">    }</span>

    // - добавление пользователя.
    public void addUser(User user) {
<span class="fc" id="L18">        bankUsers.putIfAbsent(user, new ArrayList&lt;&gt;(Collections.singletonList(new Account())));</span>
<span class="fc" id="L19">    }</span>

    //- удаление пользователя.
    public void deleteUser(User user) {
<span class="fc" id="L23">        boolean mayBeDeleted = false;</span>
<span class="pc bpc" id="L24" title="1 of 2 branches missed.">        if (!bankUsers.isEmpty()) {</span>
<span class="fc" id="L25">            mayBeDeleted = true;</span>
<span class="fc" id="L26">            Iterator&lt;Account&gt; it = bankUsers.get(user).iterator();</span>
<span class="fc bfc" id="L27" title="All 2 branches covered.">            while (it.hasNext()) {</span>
<span class="fc bfc" id="L28" title="All 2 branches covered.">                if (it.next().getValue() != 0) {</span>
<span class="fc" id="L29">                    mayBeDeleted = false;</span>
<span class="fc" id="L30">                    System.out.println(&quot;You can't revoke this account!&quot;);</span>
                }
            }
        }
<span class="fc bfc" id="L34" title="All 2 branches covered.">        if (mayBeDeleted) {</span>
<span class="fc" id="L35">            System.out.printf(&quot;The account of %s, passport number %s will be deleted.&quot;, user.getName(), user.getPassport());</span>
<span class="fc" id="L36">            bankUsers.remove(user);</span>
        }
<span class="fc" id="L38">    }</span>

    // - добавить счёт пользователю.
    public void addAccountToUser(String passport, Account account) {
<span class="fc" id="L42">        User user = this.findUser(passport);</span>
<span class="pc bpc" id="L43" title="1 of 2 branches missed.">        if (user == null) {</span>
<span class="nc" id="L44">            System.out.printf(&quot;The client with passport number %s hasn't been found!&quot;, passport);</span>
        } else {
<span class="fc" id="L46">            bankUsers.get(user).add(account);</span>
        }
<span class="fc" id="L48">    }</span>

    // - удалить один счёт пользователя.
    public void deleteAccountFromUser(String passport, Account account) {
<span class="fc" id="L52">        User user = this.findUser(passport);</span>
<span class="pc bpc" id="L53" title="1 of 2 branches missed.">        if (user == null) {</span>
<span class="nc" id="L54">            System.out.printf(&quot;The client with passport number %s hasn't been found!&quot;, passport);</span>
        } else {
<span class="fc" id="L56">            System.out.printf(&quot;The Account number %s will be deleted.\n&quot;, account.getRequisites());</span>
<span class="fc" id="L57">            bankUsers.get(user).remove(account);</span>
<span class="fc bfc" id="L58" title="All 2 branches covered.">            if (bankUsers.get(user).size() == 0) {</span>
<span class="fc" id="L59">                System.out.println(&quot;You have not more Accounts in this bank. Good-bye!&quot;);</span>
<span class="fc" id="L60">                deleteUser(user);</span>
            }
        }
<span class="fc" id="L63">    }</span>

    // - получить список счетов для пользователя.
    public List&lt;Account&gt; getUserAccounts(String passport) {
<span class="fc" id="L67">        User user = this.findUser(passport);</span>
<span class="pc bpc" id="L68" title="1 of 2 branches missed.">        if (user == null) {</span>
<span class="nc" id="L69">            System.out.printf(&quot;The client with passport number %s hasn't been found!&quot;, passport);</span>
        }
<span class="fc" id="L71">        return bankUsers.get(user);</span>
    }

    // - метод для перечисления денег с одного счёта на другой счёт:
    public boolean transferMoney(String srcPassport, String srcRequisite, String destPassport, String destRequisite, double amount) {
<span class="fc" id="L76">        boolean operationWorked = true;</span>
<span class="fc" id="L77">        User srcUser = this.findUser(srcPassport);</span>
<span class="fc" id="L78">        User destUser = this.findUser(destPassport);</span>
<span class="fc" id="L79">        int srcReqNum = this.findAccountNumber(srcUser, srcRequisite); // исправлено</span>
<span class="fc" id="L80">        int destReqNum = this.findAccountNumber(destUser, destRequisite); // исправлено</span>
<span class="pc bpc" id="L81" title="3 of 10 branches missed.">        if (srcUser != null &amp;&amp; destUser != null &amp;&amp; srcReqNum != -1 &amp;&amp; destReqNum != -1 &amp;&amp; bankUsers.get(srcUser).get(srcReqNum).getValue() &gt;= amount) {</span>
<span class="fc" id="L82">            bankUsers.get(srcUser).get(srcReqNum).setValue(bankUsers.get(srcUser).get(srcReqNum).getValue() - amount); // исправлено</span>
<span class="fc" id="L83">            bankUsers.get(destUser).get(destReqNum).setValue(bankUsers.get(destUser).get(destReqNum).getValue() + amount); // исправлено</span>
<span class="fc" id="L84">            System.out.println(&quot;Operation successfully finished!&quot;);</span>
        } else {
<span class="fc" id="L86">            System.out.println(&quot;Operation interrupted!&quot;);</span>
<span class="fc" id="L87">            operationWorked = false;</span>
        }
<span class="fc" id="L89">        return operationWorked;</span>
    }

    private User findUser(String passport) {
<span class="fc" id="L93">        User user = null;</span>
<span class="pc bpc" id="L94" title="1 of 2 branches missed.">        for (Map.Entry&lt;User, List&lt;Account&gt;&gt; entry : this.bankUsers.entrySet()) {</span>
<span class="fc bfc" id="L95" title="All 2 branches covered.">            if (entry.getKey().getPassport().equals(passport)) {</span>
<span class="fc" id="L96">                user = entry.getKey();</span>
<span class="fc" id="L97">                break;</span>
            }
<span class="fc" id="L99">        }</span>
<span class="fc" id="L100">        return user;</span>
    }

    private int findAccountNumber(User user, String requisites) {
<span class="fc" id="L104">        int result = -1;</span>
<span class="fc bfc" id="L105" title="All 2 branches covered.">        for (int i = 0; i &lt; bankUsers.get(user).size(); i++) {</span>
<span class="fc bfc" id="L106" title="All 2 branches covered.">            if (bankUsers.get(user).get(i).getRequisites().equals(requisites)) {</span>
<span class="fc" id="L107">                result = i;</span>
            }
        }
<span class="fc" id="L110">        return result;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>